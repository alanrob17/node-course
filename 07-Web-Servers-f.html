<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>07 - Web Servers</title>
<link href="assets/css/bootstrap.css" rel="stylesheet">
<!-- Custom styles for this template -->
<link href="assets/css/starter-template.css" rel="stylesheet">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=css&amp;skin=sunburst"></script>
<style type="text/css">
h2 {
	margin-top: 60px;
}

h4, h3 {
	padding-top: 40px!;		
}

p {
	font-size: 1.2em;
}
h4 {
	font-size: 1.4em;
}

img, pre.prettyprint {
	margin-top: 1.5em;
	margin-bottom: 1.5em;
}
h1, h2, h3, h4, h5, h6 {
    color:#007bff;

}
blockquote {
    border-left: 4px solid #999;
    padding-left: 1rem;
    page-break-inside: avoid;
}
</style>
</head>
<body>
<header>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">Udemy - The Complete Node.js Developer Course</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#">Home</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="#">07 - Web Servers <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<div class="container">
    <div class="starter-template">


<h2 class="code-line" data-line-start=0 data-line-end=1><a id="Web_Servers_0"></a>Web Servers</h2>
<p class="has-line-data" data-line-start="2" data-line-end="5">Node.js is commonly used as a web server to serve up websites, JSON, and more. In this<br>
section, you’ll be creating your first Node server with Express. This will allow users to<br>
interact with your application by visiting a URL in the browser.</p>
<h3 class="code-line" data-line-start=6 data-line-end=7><a id="Hello_Express_6"></a>Hello Express!</h3>
<p class="has-line-data" data-line-start="8" data-line-end="11">Serving up websites and JSON data is easy with Express. We are going to learn how to<br>
create our first web server with Express. Once the server is up and running, users will be<br>
able to interact with our application via the browser.</p>
<p class="has-line-data" data-line-start="12" data-line-end="13">First, we are going to create a new folder.</p>
<p class="has-line-data" data-line-start="14" data-line-end="15"><strong>web-server</strong></p>
<p class="has-line-data" data-line-start="16" data-line-end="17">Initialise the project.</p>
<pre class="prettyprint">    npm init -y
</pre>
<p class="has-line-data" data-line-start="22" data-line-end="23"><code>-y</code> adds defaults to all steps in the process.</p>
<p class="has-line-data" data-line-start="24" data-line-end="25">Install Express.js</p>
<pre class="prettyprint">    npm install express --save
</pre>
<p class="has-line-data" data-line-start="30" data-line-end="31">Now, we are going to change our folder structure for Express.js projects.</p>
<p class="has-line-data" data-line-start="32" data-line-end="33">Create a <code>src</code> folder and this is where we will place our <code>app.js</code> files.</p>
<h4 class="code-line" data-line-start=34 data-line-end=35><a id="appjs_34"></a>app.js</h4>
<pre class="prettyprint">    const express = require('express');

    const app = express();

    app.get('', (req, res) =&gt; {
        res.send('Hello Express World!');
    });

    app.get('/help', (req, res) =&gt; {
        res.send('Help page...');
    });

    app.listen(3000, () =&gt; {
        console.log('Server is up on port 3000...');
    });
</pre>
<p class="has-line-data" data-line-start="54" data-line-end="55">This is the code for a bare bones website with two routes, the default page and the help page.</p>
<p class="has-line-data" data-line-start="56" data-line-end="57">The code above uses <strong>app.get</strong> to set up a handler for an HTTP GET request. The first argument is the path to set up the handler for. The second argument is the function to run when that path is visited. Calling <strong>res.send</strong> in the route handler allows you to send back a message as the response. This will get shown in the browser.</p>
<p class="has-line-data" data-line-start="58" data-line-end="60">The last thing to do is start the server. This is done by calling <strong>app.listen</strong> with the port you<br>
want to listen on.</p>
<p class="has-line-data" data-line-start="61" data-line-end="62">We are going to run this with <strong>nodemon</strong>. Go to the <strong>web-server</strong> directory and run,</p>
<pre class="prettyprint">    nodemon src/app.js
</pre>
<p class="has-line-data" data-line-start="67" data-line-end="68"><strong>Note:</strong> You have to run the application from the root directory.</p>
<h5 class="code-line" data-line-start=69 data-line-end=70><a id="Challenge_69"></a>Challenge</h5>
<p class="has-line-data" data-line-start="71" data-line-end="72">Set up two new routes.</p>
<ol>
<li class="has-line-data" data-line-start="73" data-line-end="74">Set up an about page and set a page title.</li>
<li class="has-line-data" data-line-start="74" data-line-end="75">Set up a weather route and set a page title.</li>
<li class="has-line-data" data-line-start="75" data-line-end="77">Test your work by visiting both pages in the browser.</li>
</ol>
<h5 class="code-line" data-line-start=77 data-line-end=78><a id="appjs_77"></a>app.js</h5>
<pre class="prettyprint">    const express = require('express');

    const app = express();

    app.get('', (req, res) =&gt; {
        res.send('Hello Express World!');
    });

    app.get('/help', (req, res) =&gt; {
        res.send('Help page...');
    });

    app.get('/about', (req, res) =&gt; {
        res.send('About page...');
    });

    app.get('/weather', (req, res) =&gt; {
        res.send('Weather page...');
    });

    app.listen(3000, () =&gt; {
        console.log('Server is up on port 3000...');
    });
</pre>
<h3 class="code-line" data-line-start=105 data-line-end=106><a id="Serving_up_HTML_and_JSON_105"></a>Serving up HTML and JSON</h3>
<p class="has-line-data" data-line-start="107" data-line-end="108">With the basics out of the way, it’s time to serve up HTML and JSON with Express. That’ll let you serve up a static website or create an HTTP REST API designed to be consumed by a web or mobile application.</p>
<h4 class="code-line" data-line-start=109 data-line-end=110><a id="Serving_up_HTML_and_JSON_109"></a>Serving up HTML and JSON</h4>
<p class="has-line-data" data-line-start="111" data-line-end="112">Using <strong>res.send</strong>, you can send back more than just text. <strong>res.send</strong> can be used to send an HTML or JSON response. The root route below sends back some HTML to be rendered in the browser. The weather route below sends back a JSON response.</p>
<pre class="prettyprint">    app.get('/help', (req, res) =&gt; {
        res.send({
            name: 'Alan',
            age: 68
        });
    });

    app.get('/weather', (req, res) =&gt; {
        res.send('&lt;h1&gt;Weather page...&lt;/h1&gt;');
    });
</pre>
<h5 class="code-line" data-line-start=126 data-line-end=127><a id="Challenge_126"></a>Challenge</h5>
<p class="has-line-data" data-line-start="128" data-line-end="129">Update Routes</p>
<ol>
<li class="has-line-data" data-line-start="130" data-line-end="131">Set up About route to render a HTML title.</li>
<li class="has-line-data" data-line-start="131" data-line-end="132">Set up a weather route to send back some JSON objects with forecast and location strings.</li>
<li class="has-line-data" data-line-start="132" data-line-end="134">Test your code in the browser.</li>
</ol>
<h5 class="code-line" data-line-start=134 data-line-end=135><a id="Partial_appjs_134"></a>Partial app.js</h5>
<pre class="prettyprint">    app.get('/about', (req, res) =&gt; {
        res.send('&lt;h1&gt;About my website&lt;/h1&gt;');
    });

    app.get('/weather', (req, res) =&gt; {
        res.send([{
            location: 'Melbourne, Victoria',
            forecast: 12
        },{
            location: 'Dublin, Ireland',
            forecast: 14
        },{
            location: 'Lucerne, Switzerland',
            forecast: 12
        }]);
    });
</pre>
<h3 class="code-line" data-line-start=155 data-line-end=156><a id="Serving_up_Static_Assets_155"></a>Serving up Static Assets</h3>
<p class="has-line-data" data-line-start="157" data-line-end="158">Express can serve up all the assets needed for your website. This includes HTML, CSS, JavaScript, images, and more. In this lesson, you’ll learn how to serve up an entire directory with Express.</p>
<h4 class="code-line" data-line-start=159 data-line-end=160><a id="Serving_up_a_Static_Directory_159"></a>Serving up a Static Directory</h4>
<p class="has-line-data" data-line-start="161" data-line-end="162">A modern website is more than just an HTML file. It’s styles, scripts, images, and fonts. Everything needs to be exposed via the web server so the browser can load it in. With Express, it’s easy to serve up an entire directory without needing to manually serve up each asset. All Express needs is the path to the directory it should serve.</p>
<p class="has-line-data" data-line-start="163" data-line-end="164">The example below uses Nodes’ path module to generate the absolute path. The call to <strong>path.join</strong> allows you to manipulate a path by providing individual path segments. It starts with <strong>__dirname</strong> which is the directory path for the current script. From there, the second segment moves out of the <strong>src</strong> folder and into the <strong>public</strong> directory.</p>
<p class="has-line-data" data-line-start="165" data-line-end="166">The path is then provided to <strong>express.static</strong> as shown below.</p>
<pre class="prettyprint">    const path = require('path');
    const express = require('express');

    const publicDirectoryPath = path.join(__dirname, '../public');

    const app = express();

    app.use(express.static(publicDirectoryPath));

    app.get('/help', (req, res) =&gt; {
        res.send({
            name: 'Alan',
            age: 68
        });
    });

    app.get('/about', (req, res) =&gt; {
        res.send('&lt;h1&gt;About my website&lt;/h1&gt;');
    });

    app.get('/weather', (req, res) =&gt; {
        res.send([{
            location: 'Melbourne, Victoria',
            forecast: 12
        },{
            location: 'Dublin, Ireland',
            forecast: 14
        },{
            location: 'Lucerne, Switzerland',
            forecast: 12
        }]);
    });

    app.listen(3000, () =&gt; {
        console.log('Server is up on port 3000...');
    });
</pre>
<p class="has-line-data" data-line-start="206" data-line-end="207">The <code>index.html</code> page resides in the public directory. We are running from the <strong>src</strong> directory and we use <code>Path</code> to find the <code>public</code> folder so we can serve the <code>index.html</code> page which is the default. The following lines of code set up the absolute path to the public directory where our static content resides.</p>
<pre class="prettyprint">    const publicDirectoryPath = path.join(__dirname, '../public');

    const app = express();

    app.use(express.static(publicDirectoryPath));
</pre>
<p class="has-line-data" data-line-start="216" data-line-end="217">This means that the <code>app.get()</code> call to the default route is redundant so can be removed.</p>
<h5 class="code-line" data-line-start=218 data-line-end=219><a id="Challenge_218"></a>Challenge</h5>
<p class="has-line-data" data-line-start="220" data-line-end="221">Create two more HTML pages.</p>
<ol>
<li class="has-line-data" data-line-start="222" data-line-end="223">Create an About HTML page with an “About” title.</li>
<li class="has-line-data" data-line-start="223" data-line-end="224">Create a Help HTML page with a “Help” title.</li>
<li class="has-line-data" data-line-start="224" data-line-end="225">Remove the old route handlers for both.</li>
<li class="has-line-data" data-line-start="225" data-line-end="227">test your work by visiting both pages.</li>
</ol>
<h5 class="code-line" data-line-start=227 data-line-end=228><a id="appjs_227"></a>app.js</h5>
<pre class="prettyprint">    const path = require('path');
    const express = require('express');

    console.log(__dirname);
    console.log(path.join(__dirname, '../public'));

    const publicDirectoryPath = path.join(__dirname, '../public');

    const app = express();

    app.use(express.static(publicDirectoryPath));

    app.get('/weather', (req, res) =&gt; {
        res.send([{
            location: 'Melbourne, Victoria',
            forecast: 12
        },{
            location: 'Dublin, Ireland',
            forecast: 14
        },{
            location: 'Lucerne, Switzerland',
            forecast: 12
        }]);
    });

    app.listen(3000, () =&gt; {
        console.log('Server is up on port 3000...');
    });
</pre>
<h3 class="code-line" data-line-start=260 data-line-end=261><a id="Serving_up_CSS_JS_Images_and_More_260"></a>Serving up CSS, JS, Images, and More</h3>
<p class="has-line-data" data-line-start="262" data-line-end="263">We will use the Express server to serve up a webpage with images, styles, and scripts.</p>
<p class="has-line-data" data-line-start="264" data-line-end="265">All files in public are exposed via the Express server. This is where your site assets need to live. If they’re not in public, then they’re not public and the browser won’t be able to load them correctly. The HTML file below shows how you can use a CSS file, JavaScript file, and image in your website.</p>
<pre class="prettyprint">    &lt;!DOCTYPE html&gt;
    &lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
        &lt;title&gt;Weather app&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/styles.css&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;About&lt;/h1&gt;
        &lt;img src=&quot;/images/profile.jpg&quot; alt=&quot;Profile picture&quot; /&gt;

    &lt;/body&gt;
    &lt;/html&gt;
</pre>
<h3 class="code-line" data-line-start=283 data-line-end=284><a id="Dynamic_Pages_with_Templating_283"></a>Dynamic Pages with Templating</h3>
<p class="has-line-data" data-line-start="285" data-line-end="286">Your web pages don’t have to be static. Express supports templating engines that allow you to render dynamic HTML pages. In this lesson, you’ll learn how to set up the Handlebars templating engine with Express.</p>
<h4 class="code-line" data-line-start=287 data-line-end=288><a id="Setting_up_Handlebars_287"></a>Setting up Handlebars</h4>
<p class="has-line-data" data-line-start="289" data-line-end="290">Start by installing Handlebars in your project.</p>
<pre class="prettyprint">    npm i hbs
</pre>

<p class="has-line-data">We need to setup handlebars.</p>

<pre class="prettyprint">    const hbs = require('hbs');
</pre>

<p class="has-line-data" data-line-start="295" data-line-end="296">From there, you’ll need to use <strong>app.set</strong> to set a value for the <code>'view engine'</code> config option. The value is the name of the template engine module you installed. That’s <code>'hbs'</code>.</p>
<pre class="prettyprint">    app.set('view engine', 'hbs');
</pre>
<p class="has-line-data" data-line-start="301" data-line-end="302">You have to set up a view so we have <code>app.get()</code> set up for the default document.</p>
<pre class="prettyprint">    const app = express();

    app.set('view engine', 'hbs');
    app.use(express.static(publicDirectoryPath));

    app.get('', (req, res) =&gt; {
        res.render('index');
    });
</pre>
<p class="has-line-data" data-line-start="314" data-line-end="315">Create a <strong>views</strong> folder in the root of your application. Add and <strong>index.hbs</strong> file and copy over the contents from <strong>index.html</strong>.</p>
<p class="has-line-data" data-line-start="316" data-line-end="317">We can now delete <strong>index.html</strong> as we are going to uses the handlebars <strong>index.hbs</strong> file from now on. Change the header to <code>Weather</code>. and run the application.</p>
<p class="has-line-data" data-line-start="318" data-line-end="319"><strong>Note:</strong> You can continue to serve static page from <strong>public</strong> if you want or dynamic pages from the <strong>views</strong> folder.</p>
<p class="has-line-data" data-line-start="320" data-line-end="321"><img src="assets/images/using-handlebars.jpg" alt="Rendering views" title="Rendering views"></p>
<h4 class="code-line" data-line-start=322 data-line-end=323><a id="Rendering_Handlebars_Templates_322"></a>Rendering Handlebars Templates</h4>
<p class="has-line-data" data-line-start="324" data-line-end="325">By default, Express expects your views to live in a views directory inside of your project root.</p>
<p class="has-line-data" data-line-start="326" data-line-end="327">Below is an example handlebars view in <strong>views/index.hbs</strong>. This looks like a normal HTML document with a few new features. Notice <code>{{title}}</code> and <code>{{name}}</code>. This is a Handlebars syntax which allows you to inject variables inside of the template. This is what allows you to generate dynamic pages.</p>
<pre class="prettyprint">
    &lt;h1&gt;{{title}}&lt;/h1&gt;
    &lt;p&gt;Created by {{name}}.&lt;/p&gt;
</pre>
<p class="has-line-data" data-line-start="334" data-line-end="335">We are now going to build up the other pages as dynamic pages.</p>
<h5 class="code-line" data-line-start=336 data-line-end=337><a id="Challenge_336"></a>Challenge</h5>
<p class="has-line-data" data-line-start="338" data-line-end="339">Create a template for the Help page.</p>
<ol>
<li class="has-line-data" data-line-start="340" data-line-end="341">Set up a help template to render a help message to the screen.</li>
<li class="has-line-data" data-line-start="341" data-line-end="342">Set up the help route and render the template with a help message.</li>
<li class="has-line-data" data-line-start="342" data-line-end="344">Visit the route in the browser and see your help message print.</li>
</ol>
<h5 class="code-line" data-line-start=344 data-line-end=345><a id="partial_helphbs_344"></a>partial help.hbs</h5>
<pre class="prettyprint">    &lt;h1&gt;{{title}}&lt;/h1&gt;
    &lt;p&gt;{{message}}&lt;/p&gt;
</pre>
<h5 class="code-line" data-line-start=351 data-line-end=352><a id="partial_appjs_351"></a>partial app.js</h5>
<pre class="prettyprint">    app.get('', (req, res) =&gt; {
        res.render('index', {
            title: 'Weather',
            name: 'Alan Robson'
        });
    });

    app.get('/about', (req, res) =&gt; {
        res.render('about', {
            title: 'About me',
            name: 'Alan Robson'
        });
    });

    app.get('/help', (req, res) =&gt; {
        res.render('help', {
            title: 'Help page',
            message: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit. Cumque reprehenderit fugit soluta veritatis obcaecati corrupti nobis commodi libero laborum consequatur, assumenda, eligendi, tempore sint iusto quo minus doloribus inventore molestiae blanditiis id impedit dolorem neque dolorum fugiat. Similique, eum alias.'
        });
    });
</pre>
<h3 class="code-line" data-line-start=376 data-line-end=377><a id="Customizing_the_Views_Directory_376"></a>Customizing the Views Directory</h3>
<p class="has-line-data" data-line-start="378" data-line-end="379">We are going to customize the name and location of the views directory.</p>
<p class="has-line-data" data-line-start="380" data-line-end="381">You can customize the location of the views directory by providing Express with the new path. Call <strong>app.set</strong> to set a new value for the <code>'views'</code> option. The example below configures Express to look for views in <code>templates</code>.</p>
<h4 class="code-line" data-line-start=382 data-line-end=383><a id="Setting_up_the_templates_folder_382"></a>Setting up the templates folder</h4>
<pre class="prettyprint">    // Define paths for Express config.
    const publicDirectoryPath = path.join(__dirname, '../public');
    const viewsPath = path.join(__dirname, '../templates');

    const app = express();

    // Setup handlebars engine and views location.
    app.set('view engine', 'hbs');
    app.set('views', viewsPath);

    // Setup static directory to serve.
    app.use(express.static(publicDirectoryPath));
</pre>
<h3 class="code-line" data-line-start=399 data-line-end=400><a id="Advanced_Templating_399"></a>Advanced Templating</h3>
<p class="has-line-data" data-line-start="401" data-line-end="402">We will now learn how to work with Handlebars partials. As the name suggests, partials are just part of a web page. Partials are great for things you need to show on multiple pages like headers, footers, and navigation bars.</p>
<h4 class="code-line" data-line-start=403 data-line-end=404><a id="Setting_up_Partials_403"></a>Setting up Partials</h4>
<p class="has-line-data" data-line-start="405" data-line-end="406">You can use partials by telling Handlebars where you’d like to store them. This is done with a call to <code>hbs.registerPartials</code>. It expects to get called with the <strong>absolute</strong> path to the partials directory.</p>
<pre class="prettyprint">    const hbs = require('hbs');

    console.log(__dirname);
    console.log(path.join(__dirname, '../public'));

    // Define paths for Express config.
    const publicDirectoryPath = path.join(__dirname, '../public');
    const viewsPath = path.join(__dirname, '../templates/views');
    const partialsPath = path.join(__dirname, '../templates/partials');

    const app = express();

    // Setup handlebars engine and views location.
    app.set('view engine', 'hbs');
    app.set('views', viewsPath);
    hbs.registerPartials(partialsPath);

    // Setup static directory to serve.
    app.use(express.static(publicDirectoryPath));
</pre>
<p class="has-line-data" data-line-start="429" data-line-end="430">Now if we try to run this app it will fail. We have to tell <strong>nodemon</strong> to look for particular file types.</p>
<pre class="prettyprint">    nodemon src/app -e js,hbs
</pre>
<p class="has-line-data" data-line-start="435" data-line-end="436">Now it will be able to find the hbs partials files.</p>
<h5 class="code-line" data-line-start=437 data-line-end=438><a id="headerhbs_437"></a>header.hbs</h5>
<pre class="prettyprint">    &lt;h1&gt;Static Handlebars partial template&lt;/h1&gt;
</pre>
<p class="has-line-data" data-line-start="443" data-line-end="444">Add it to the help file</p>
<h5 class="code-line" data-line-start=445 data-line-end=446><a id="helphbs_445"></a>help.hbs</h5>
<pre class="prettyprint">    &lt;body&gt;
        {{&gt;header}}
        &lt;h1&gt;{{title}}&lt;/h1&gt;
        &lt;p&gt;{{message}}&lt;/p&gt;
    &lt;/body&gt;
</pre>
<p class="has-line-data" data-line-start="455" data-line-end="456">To use partials requires the <code>&gt;</code> symbol to render the partial file.</p>
<p class="has-line-data" data-line-start="457" data-line-end="458"><img src="assets/images/handlebars-partials.jpg" alt="Rendering partials" title="Rendering partials"></p>
<p class="has-line-data" data-line-start="459" data-line-end="460">Now we will change all headers to the <code>header.hbs</code> partial file.</p>
<h5 class="code-line" data-line-start=461 data-line-end=462><a id="indexhbs_461"></a>index.hbs</h5>
<pre class="prettyprint">    {{&gt;header}}
    &lt;p&gt;Created by {{name}}.&lt;/p&gt;
</pre>
<p class="has-line-data" data-line-start="468" data-line-end="469">Change the <code>header.hbs</code> file.</p>
<pre class="prettyprint">    &lt;h1&gt;{{title}}&lt;/h1&gt;
</pre>
<p class="has-line-data" data-line-start="474" data-line-end="475">Make sure all pages have a <code>title</code> and a <code>name</code>. e.g <code>index.hbs</code>.</p>
<pre class="prettyprint">    app.get('', (req, res) =&gt; {
        res.render('index', {
            title: 'Weather',
            name: 'Alan Robson'
        });
    });

    app.get('/about', (req, res) =&gt; {
        res.render('about', {
            title: 'About me',
            name: 'Alan Robson'
        });
    });

    app.get('/help', (req, res) =&gt; {
        res.render('help', {
            title: 'Help',
            name: 'Alan Robson',
            message: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit.'
        });
    });
</pre>
<p class="has-line-data" data-line-start="500" data-line-end="501">You can add some navigation into <code>header.hbs</code> and this will be shown on every page.</p>
<pre class="prettyprint">    &lt;div&gt;
        &lt;a href=&quot;/&quot;&gt;Weather&lt;/a&gt;
        &lt;a href=&quot;/about&quot;&gt;About&lt;/a&gt;
        &lt;a href=&quot;/help&quot;&gt;Help&lt;/a&gt;
    &lt;/div&gt;
</pre>
<p class="has-line-data" data-line-start="510" data-line-end="511"><img src="assets/images/navigation.jpg" alt="Add navigation" title="Add navigation"></p>
<p class="has-line-data" data-line-start="512" data-line-end="513">.</p>
<p class="has-line-data" data-line-start="514" data-line-end="515"><img src="assets/images/about.jpg" alt="About page" title="About page"></p>
<h5 class="code-line" data-line-start=516 data-line-end=517><a id="Challenge_516"></a>Challenge</h5>
<p class="has-line-data" data-line-start="518" data-line-end="519">Create a partial for the footer.</p>
<ol>
<li class="has-line-data" data-line-start="520" data-line-end="521">Set up the partial for the footer template.</li>
<li class="has-line-data" data-line-start="521" data-line-end="522">Render the partial at the bottom of all three pages.</li>
<li class="has-line-data" data-line-start="522" data-line-end="524">Test your work.</li>
</ol>
<h5 class="code-line" data-line-start=524 data-line-end=525><a id="footerhbs_524"></a>footer.hbs</h5>
<pre class="prettyprint">    &lt;div id=&quot;footer&quot;&gt;
        &lt;div class=&quot;copyright&quot;&gt;Created by {{name}}. @2020&lt;/div&gt;
    &lt;/div&gt;
</pre>
<h5 class="code-line" data-line-start=532 data-line-end=533><a id="indexhbs_532"></a>index.hbs</h5>
<pre class="prettyprint">    &lt;body&gt;
        {{&gt;header}}

        {{&gt;footer}}
    &lt;/body&gt;
</pre>
<h3 class="code-line" data-line-start=542 data-line-end=543><a id="404_Pages_542"></a>404 Pages</h3>
<p class="has-line-data" data-line-start="544" data-line-end="545">We will now set up a 404 page. The 404 page will show when a user tries to visit a page that doesn’t exist.</p>
<h4 class="code-line" data-line-start=546 data-line-end=547><a id="Setting_up_a_404_Page_546"></a>Setting up a 404 Page</h4>
<p class="has-line-data" data-line-start="548" data-line-end="549">Express has support for <code>*</code> in route paths. This is a special character which matches anything. This can be used to create a route handler that matches all requests. The 404 page should be set up just before the call to <strong>app.listen</strong>. This ensures that requests for valid pages still get the correct response.</p>
<h3 class="code-line" data-line-start=550 data-line-end=551><a id="Accessing_API_from_Browser_550"></a>Accessing API from Browser</h3>
<h4 class="code-line" data-line-start=552 data-line-end=553><a id="Section_Intro_552"></a>Section Intro</h4>
<p class="has-line-data" data-line-start="554" data-line-end="555">In this section, you’ll learn how to set up communication between the client and the server. This will be done via HTTP requests. By the end of the section, users will be able to type an address in the browser to view their forecast.</p>
<h4 class="code-line" data-line-start=556 data-line-end=557><a id="The_Query_String_556"></a>The Query String</h4>
<p class="has-line-data" data-line-start="558" data-line-end="560">We need to use query strings to pass data from the client to the server. This will be used to send the address from the browser to Node.js. Node.js will then be able to fetch the weather for the address and send the forecast back to the<br>
browser.</p>
<h4 class="code-line" data-line-start=561 data-line-end=562><a id="Working_with_Query_Strings_561"></a>Working with Query Strings</h4>
<p class="has-line-data" data-line-start="563" data-line-end="564">The query string is a portion of the URL that allows you to provide additional information to the server. For the weather application, the query string will be used to pass the address from the browser to the Node.js Express application.</p>
<p class="has-line-data" data-line-start="565" data-line-end="566">We are going set up a <strong>products</strong> route to get a query string to search through a list of products.</p>
<pre class="prettyprint">    app.get('/products', (req, res) =&gt; {

        if (!req.query.search) {
            return res.send({
                error: 'You must provide a search term!'
            });
        }

        console.log(req.query);

        res.send({
            products: []
        });
    });
</pre>
<p class="has-line-data" data-line-start="584" data-line-end="585">This allows us to search for products with a query string.</p>
<pre class="prettyprint">    http://localhost:3000/products?search=games
</pre>
<p class="has-line-data" data-line-start="590" data-line-end="591">We will use a <code>console.log()</code> to show what is returned. At present there are no products so you will see this in the terminal.</p>
<pre class="prettyprint">    { search: 'games' }
</pre>
<p class="has-line-data" data-line-start="596" data-line-end="597">If you fail to add a search query string you will receive a json error.</p>
<pre class="prettyprint">    { &quot;error&quot;: &quot;You must provide a search term!&quot; }
</pre>
<p class="has-line-data" data-line-start="602" data-line-end="603"><strong>Note</strong> We have added a <strong>return</strong> in case a query string isn’t added to the request. This stops the code from continuing on to option to get the products data.</p>
<h5 class="code-line" data-line-start=604 data-line-end=605><a id="Challenge_604"></a>Challenge</h5>
<p class="has-line-data" data-line-start="606" data-line-end="607">Update weather endpoint to accept address</p>
<ol>
<li class="has-line-data" data-line-start="608" data-line-end="609">No address, send back an error message.</li>
<li class="has-line-data" data-line-start="609" data-line-end="610">Address, send back the JSON - and address property onto JSON which returns the provided address.</li>
<li class="has-line-data" data-line-start="610" data-line-end="612">Test /weather, weather?address=Melbourne</li>
</ol>
<pre class="prettyprint">    app.get('/weather', (req, res) =&gt; {

        if (!req.query.address) {
            return res.send({
                error: 'You must provide an address!'
            });
        }

        console.log(req.query);

        res.send({
            address: req.query.address
        });
    });
</pre>
<blockquote>
<p class="has-line-data" data-line-start="629" data-line-end="630">{ “address”: “Melbourne” }</p>
</blockquote>
<h3 class="code-line" data-line-start=631 data-line-end=632><a id="Building_a_JSON_HTTP_Endpoint_631"></a>Building a JSON HTTP Endpoint</h3>
<p class="has-line-data" data-line-start="633" data-line-end="634">The weather application already has the code in place to fetch the weather for a given address. we are going to wire up the route handler to fetch the weather and send it back to the browser.</p>
<h4 class="code-line" data-line-start=635 data-line-end=636><a id="ES6_Aside_Default_Function_Parameters_635"></a>ES6 Aside: Default Function Parameters</h4>
<p class="has-line-data" data-line-start="637" data-line-end="638">ES6 provides a new syntax to set default values for function arguments. We will use the new syntax to improve and clean up the application code.</p>
<p class="has-line-data" data-line-start="639" data-line-end="640">We need to copy the <strong>utils</strong> folder from <code>weather-app</code> to <code>web-server</code>. Now we need to install <strong>postman-request</strong> in <code>web-server</code>.</p>
<pre class="prettyprint">    npm install postman-request
</pre>
<h5 class="code-line" data-line-start=645 data-line-end=646><a id="Challenge_645"></a>Challenge</h5>
<p class="has-line-data" data-line-start="647" data-line-end="648">Wire up weather</p>
<ol>
<li class="has-line-data" data-line-start="649" data-line-end="650">Require geocode/forecast into app.js.</li>
<li class="has-line-data" data-line-start="650" data-line-end="651">Use the address to geocode.</li>
<li class="has-line-data" data-line-start="651" data-line-end="652">Pass the coordinates to forecast.</li>
<li class="has-line-data" data-line-start="652" data-line-end="654">Send back the real forecast and location.</li>
</ol>
<h5 class="code-line" data-line-start=654 data-line-end=655><a id="appjs_654"></a>app.js</h5>
<pre class="prettyprint">    app.get('/weather', (req, res) =&gt; {

        if (!req.query.address) {
            return res.send({
                error: 'You must provide an address!'
            });
        }

        geocode(req.query.address, (error, { latitude, longitude, location }) =&gt; {
            if (error) {
                return req.send({ error });
            }

            forecast(latitude, longitude, (error, forecastData) =&gt; {
                if (error) {
                    return req.send( { error });
                }

                res.send({
                    forecast: forecastData,
                    location,
                    address: req.query.address
                });
            });
        });
    });
</pre>
<blockquote>
<p class="has-line-data" data-line-start="685" data-line-end="690">{<br>
“forecast”: “It is currently 3 degrees out. It is Mist and there is 0% chance of rain.”,<br>
“location”: “Ballarat, Victoria, Australia”,<br>
“address”: “Ballarat, Vic”<br>
}</p>
</blockquote>
<h3 class="code-line" data-line-start=691 data-line-end=692><a id="ES6_Aside_Default_Function_Parameters_691"></a>ES6 Aside: Default Function Parameters</h3>
<p class="has-line-data" data-line-start="693" data-line-end="694">ES6 provides a new syntax to set default values for function arguments. we will use this new syntax to improve and clean up the application code.</p>
<h4 class="code-line" data-line-start=695 data-line-end=696><a id="Default_Function_Parameters_695"></a>Default Function Parameters</h4>
<p class="has-line-data" data-line-start="697" data-line-end="698">Function parameters are undefined unless an argument value is provided when the function is called. ES6 now allows function parameters to be configured with a custom default value.</p>
<p class="has-line-data" data-line-start="699" data-line-end="700">You can see this in action for the greeter function below. name will be ‘user’ if no value is provided. age will be undefined if no value is provided.</p>
<pre class="prettyprint">    const greeter = (name = 'user', age) =&gt; {
    console.log('Hello ' + name);
    }

    greeter('Alan');

    greeter();
</pre>
<blockquote>
<p class="has-line-data" data-line-start="711" data-line-end="713">Hello Alan<br>
Hello user</p>
</blockquote>
<p class="has-line-data" data-line-start="714" data-line-end="715">This code will fail with an exception because it doesn’t have any defaults.</p>
<pre class="prettyprint">    const transaction = (type, { label, stock }) =&gt; {
        console.log(type, label, stock);
    }

    transaction('order');
</pre>
<p class="has-line-data" data-line-start="724" data-line-end="725">The default syntax can be used to provide default values when using ES6 destructuring. The transaction function below shows this off by providing a default value for stock.</p>
<pre class="prettyprint">    const transaction = (type, { label, stock = 0 } = {}) =&gt; {
        console.log(type, label, stock);
    }

    transaction('order');
</pre>
<blockquote>
<p class="has-line-data" data-line-start="734" data-line-end="735">order undefined 0</p>
</blockquote>
<p class="has-line-data" data-line-start="736" data-line-end="737">The code above doesn’t cause an exception error.</p>
<p class="has-line-data" data-line-start="738" data-line-end="739">We can now use the default syntax in our <em>web-server</em> application. If we run the app with the following.</p>
<pre class="prettyprint">    http://localhost:3000/weather?address=!
</pre>
<p class="has-line-data" data-line-start="745" data-line-end="746">We get an exception and the page fails to load. The web server stops with the error message.</p>
<blockquote>
<p class="has-line-data" data-line-start="747" data-line-end="748">TypeError: Cannot read property ‘center’ of undefined</p>
</blockquote>
<p class="has-line-data" data-line-start="749" data-line-end="750">In <code>geocode()</code> we provide an <code>error</code> because no address was passed in but we run into a problem because we are trying to destructure and object with values <code>latitude</code>, <code>longitude</code> and <code>location</code>.</p>
<p class="has-line-data" data-line-start="751" data-line-end="752">We can fix this by adding an empty default object.</p>
<pre class="prettyprint">    geocode(req.query.address, (error, { latitude, longitude, location } = {}) =&gt; {
</pre>
<h3 class="code-line" data-line-start=757 data-line-end=758><a id="Browser_HTTP_Requests_with_Fetch_757"></a>Browser HTTP Requests with Fetch</h3>
<p class="has-line-data" data-line-start="759" data-line-end="760">In this lesson, you’ll learn how to make HTTP AJAX requests from the browser. This will allow the web application to request the forecast from the Node.js server.</p>
<h4 class="code-line" data-line-start=761 data-line-end=762><a id="The_Fetch_API_761"></a>The Fetch API</h4>
<p class="has-line-data" data-line-start="763" data-line-end="764">Web APIs provide you with a way to make HTTP requests from JavaScript in the browser. This is done using the <strong>fetch</strong> function. <strong>fetch</strong> expects to be called with the URL as the first argument. It sends off the HTTP request and gives you back the response.</p>
<p class="has-line-data" data-line-start="765" data-line-end="766">We will do a simple <code>fetch()</code> call to get a puzzle.</p>
<pre class="prettyprint">    fetch('http://puzzle.mead.io/puzzle').then((response) =&gt; {
        response.json().then((data) =&gt; {
            console.log(data.puzzle);
        });
    });
</pre>
<p class="has-line-data" data-line-start="775" data-line-end="777">The <strong>fetch</strong> call below is used to <strong>fetch</strong> the weather for Ballarat. An if statement is then used<br>
to either print the forecast or the error message.</p>
<pre class="prettyprint">    fetch('http://localhost:3000/weather?address=Ballarat').then((response) =&gt; {
        response.json().then((data) =&gt; {
            if (data.error) {
                console.log(data.error);
            } else {
                console.log(data.location);
                console.log(data.forecast);
            }
        });
    });
</pre>
<blockquote>
<p class="has-line-data" data-line-start="791" data-line-end="793">Ballarat, Victoria, Australia<br>
It is currently 11 degrees out. It is Partly cloudy and there is 0% chance of rain.</p>
</blockquote>
<p class="has-line-data" data-line-start="794" data-line-end="795"><strong>Note:</strong> The fetch API will not work in Node.js. We need to use it in a page script file.</p>
<h3 class="code-line" data-line-start=796 data-line-end=797><a id="Creating_a_Search_Form_796"></a>Creating a Search Form</h3>
<p class="has-line-data" data-line-start="798" data-line-end="799">We can now set up the weather search form. This will allow a visitor to type in a location, click submit and then see their real time information.</p>
<h5 class="code-line" data-line-start=800 data-line-end=801><a id="indexhbs_800"></a>index.hbs</h5>
<pre class="prettyprint">    &lt;div class=&quot;main-content&quot;&gt;
        {{&gt;header}}

        &lt;p&gt;Use this site to get your weather!&lt;/p&gt;
        &lt;form action=&quot;&quot;&gt;
            &lt;input type=&quot;text&quot; placeholder=&quot;Location...&quot;&gt;
            &lt;button&gt;Search&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;

    {{&gt;footer}}

    &lt;script src=&quot;/js/app.js&quot;&gt;&lt;/script&gt;
</pre>
<h5 class="code-line" data-line-start=818 data-line-end=819><a id="publicjsappjs_818"></a>public/js/app.js</h5>
<pre class="prettyprint">    const getForecast = (location) =&gt; {
        const url = 'http://localhost:3000/weather?address=' + location;

        fetch(url).then((response) =&gt; {
            response.json().then((data) =&gt; {
                if (data.error) {
                    console.log(data.error);
                } else {
                    console.log(data.location);
                    console.log(data.forecast);
                }
            });
        });
    }

    const weatherForm = document.querySelector('form');
    const search = document.querySelector('input');

    weatherForm.addEventListener('submit', (e) =&gt; {
        e.preventDefault();

        const location = search.value;
        getForecast(location)
    });
</pre>
<h3 class="code-line" data-line-start=847 data-line-end=848><a id="Wiring_up_the_User_Interface_847"></a>Wiring up the User Interface</h3>
<p class="has-line-data" data-line-start="849" data-line-end="850">Now, we will learn how to manipulate the text content of HTML elements from JavaScript. That will allow the weather application to render the forecast data to the browser instead of the console.</p>
<h4 class="code-line" data-line-start=851 data-line-end=852><a id="Rendering_Dynamic_textContent_851"></a>Rendering Dynamic textContent</h4>
<p class="has-line-data" data-line-start="853" data-line-end="854">Set up HTML elements for the messages you want to render. Below is an example paragraph which can be used to render some text from JavaScript. It contains no text by default. It will be updated to show some text as the client-side JavaScript runs.</p>
<pre class="prettyprint">    &lt;p id=&quot;message-1&quot;&gt;&lt;/p&gt;
</pre>
<p class="has-line-data" data-line-start="859" data-line-end="860">The code below can be used to change the text content of the paragraph. First up, <strong>document.querySelector</strong> is used to target the element. It’s used with #, which searches for elements by their ID. The text content can be updated by setting a value on the <strong>textContent</strong> property.</p>
<h5 class="code-line" data-line-start=861 data-line-end=862><a id="Challenge_861"></a>Challenge</h5>
<p class="has-line-data" data-line-start="863" data-line-end="864">Rendering content to paragraphs.</p>
<ol>
<li class="has-line-data" data-line-start="865" data-line-end="866">Select the second p from JavaScript.</li>
<li class="has-line-data" data-line-start="866" data-line-end="867">Just before fetch, render loading message and empty p.</li>
<li class="has-line-data" data-line-start="867" data-line-end="868">If error, render error.</li>
<li class="has-line-data" data-line-start="868" data-line-end="869">If no error, render location and forecast.</li>
<li class="has-line-data" data-line-start="869" data-line-end="871">Test your work for valid and invalid input.</li>
</ol>
<h5 class="code-line" data-line-start=871 data-line-end=872><a id="publicjsappjs_871"></a>public/js/app.js</h5>
<pre class="prettyprint">    const getForecast = (location) =&gt; {
        const url = 'http://localhost:3000/weather?address=' + location;

        fetch(url).then((response) =&gt; {
            response.json().then((data) =&gt; {
                if (data.error) {
                    messageOne.textContent = data.error;
                    messageTwo.textContent = '';
                } else {
                    messageOne.textContent = data.location;
                    messageTwo.textContent = data.forecast;
                }
            });
        });
    }

    const weatherForm = document.querySelector('form');
    const search = document.querySelector('input');
    const messageOne = document.querySelector('#message-1');
    const messageTwo = document.querySelector('#message-2');

    weatherForm.addEventListener('submit', (e) =&gt; {
        e.preventDefault();

        const location = search.value;
        messageOne.textContent = 'Loading...';
        messageTwo.textContent = '';
        getForecast(location)
    });
</pre>
<h5 class="code-line" data-line-start=905 data-line-end=906><a id="indexhbs_905"></a>index.hbs</h5>
<pre class="prettyprint">    &lt;div class=&quot;main-content&quot;&gt;
        {{&gt;header}}

        &lt;p&gt;Use this site to get your weather!&lt;/p&gt;
        &lt;form action=&quot;&quot;&gt;
            &lt;input type=&quot;text&quot; placeholder=&quot;Location...&quot;&gt;
            &lt;button&gt;Search&lt;/button&gt;
        &lt;/form&gt;

        &lt;p id=&quot;message-1&quot;&gt;&lt;/p&gt;
        &lt;p id=&quot;message-2&quot;&gt;&lt;/p&gt;
    &lt;/div&gt;

    {{&gt;footer}}

    &lt;script src=&quot;/js/app.js&quot;&gt;&lt;/script&gt;
</pre>
<h5 class="code-line" data-line-start=926 data-line-end=927><a id="stylescss_input_elements_926"></a>styles.css (input elements)</h5>
<pre class="prettyprint">    input {
        border: 1px solid #cccccc;
        padding: 8px;
    }

    button {
        cursor: pointer;
        border: 1px solid #888888;
        background: #888888;
        color: white;
        padding: 8px;
    }
</pre>



</div><!-- starter-template -->
</div><!-- /.container -->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"/>
<script>hljs.initHighlightingOnLoad();</script>

<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
</body>
</html>